<% content_for :page_subtitle do %>
    Schedule
<% end %>
<% content_for :meta_description do %>
    Check out the schedules for all the currently running AD2L tournaments
<% end %>
<% content_for :subnav do %>
    <ul class="nav nav-tabs">
		<%- @seasons.each do |season| %>
            <% unless season.active == false %>
        	   <li class="tab <%= (@season == season ? "active" : "")%>" + ><%= link_to season.title, season %></li>
            <%end%>
        <% end %>
    </ul>
<% end %>

<% cache_unless @no_cache, "seasonPage-" + @season.id.to_s, skip_digest: true do %>
    <div style="clear: both"></div>
    <div class="TabsContainer">
        <div class="tabbody3 active">
            <div class="steam_chat container-fluid">
                Can't find your opponent?  Join the <a href="steam://friends/joinchat/103582791435143521" class="btn btn-primary">STEAM group chat!</a>
            </div>
            <% if (@season.challonge_url && !@season.challonge_tournament) || (@season.challonge_tournament && @season.challonge_tournament.state != "pending") %>
                <iframe src="http://challonge.com/<%=@season.challonge_url%>/module" width="1100px" height="1000px" frameborder="0" scrolling="auto" allowtransparency="true"></iframe>
            <% else %>
                <div class="col-sm-4">
                    <h2 class="rankings">Rankings</h2>                        
                    <%= render :partial => "seasons/season_rankings", :object => @teams_by_division, :object => @total_scores, :object => @season %>
                </div>
                <div class="col-sm-8 col-sm-offset-0 col-md-6 col-md-offset-2">
                    <% if @season.team_tourney %>
                        <h2>Schedule</h2>
                        <% if @season.challonge_tournament || (@season.late_fee_start && @season.late_fee_start > Time.now) %>
                            <%if @season.challonge_id.nil?%>
                                <p>Schedule will be released when the tournament starts on <%= format_date(@season.start_date) %></p>
                            <% else %>
                                <p>Schedule will be released when the tournament starts on <%= format_datetime_month(@season.start_date) %></p>
                            <% end %>
                        <% else %>
                            <ul class="list-inline week-selector">
                                <span class="week">Week</span>
                                <% @season.matches.pluck(:week).uniq.sort.each do |week_num| %>
                                    <li><%= link_to week_num, {:week => week_num}, "data-week" => week_num, :class => ("active" if week_num == @week_num) %></li>
                                <% end %>
                            </ul>
                            <% @season.matches.pluck(:week).uniq.sort.each do |week_num| %>
                                <div class="week-holder" id="week_<%= week_num %>" style='<%= "display: none;" unless @week_num == week_num %>'>
                                    <%= render :partial => "matches/match_table", :object => @matches.select{|m| m.week == week_num } %>
                                </div>
                            <% end %>
                        <% end %>
                    <% else %>
                        <!-- Solo tourney stuff -->
                        <h2>Matches</h2>
                        <% @solo_league_matches.each do |sl_match| %>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th colspan="3">Match name and lobby password: <%=sl_match.lobby_password%></th>
                                    </tr>
                                    <tr>
                                        <th>
                                            Home
                                            <% if sl_match.home_wins %> 
                                                <b>Winner!</b>
                                            <% end %>
                                        </th>
                                        <th width="75px">                                        
                                            <% if Permissions.can_edit?(@season) %>
                                                <input type="checkbox" <% if sl_match.home_wins %> checked <% end %> class="form-control home_wins" season="<%=@season.id%>" match="<%=sl_match.id%>"/>
                                            <% end %>
                                        </th>
                                        <th>
                                            Away
                                            <% if sl_match.home_wins == false %>
                                                <b>Winner!</b>
                                            <% end %>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><%=link_to sl_match.home_player_1.name, sl_match.home_player_1%> (Lobby host)</td>
                                        <td></td>
                                        <td><%=link_to sl_match.away_player_1.name, sl_match.away_player_1%></td>
                                    </tr>
                                    <tr>
                                        <td><%=link_to sl_match.home_player_2.name, sl_match.home_player_2%></td>
                                        <td></td>
                                        <td><%=link_to sl_match.away_player_2.name, sl_match.away_player_2%></td>
                                    </tr>
                                    <tr>
                                        <td><%=link_to sl_match.home_player_3.name, sl_match.home_player_3%></td>
                                        <td></td>
                                        <td><%=link_to sl_match.away_player_3.name, sl_match.away_player_3%></td>
                                    </tr>
                                    <tr>
                                        <td><%=link_to sl_match.home_player_4.name, sl_match.home_player_4%></td>
                                        <td></td>
                                        <td><%=link_to sl_match.away_player_4.name, sl_match.away_player_4%></td>
                                    </tr>
                                    <tr>
                                        <td><%=link_to sl_match.home_player_5.name, sl_match.home_player_5%></td>
                                        <td></td>
                                        <td><%=link_to sl_match.away_player_5.name, sl_match.away_player_5%></td>
                                    </tr>
                                </tbody>
                                
                            </table>
                        <% end %>
                    <% end %>
                </div>
            <%end%>
        </div>
    </div>
<% end %>